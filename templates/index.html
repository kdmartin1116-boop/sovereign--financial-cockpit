<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sovereign Finance Cockpit</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div id="global-loader" class="loader-overlay hidden" role="status" aria-live="polite">
    <div class="loader" aria-label="Loading..."></div>
  </div>

  <header class="app-header">
    <h1>üß† Sovereign Finance Cockpit</h1>
    <div id="status" class="status-message"></div>
  </header>

  <div class="app-container">
    <nav class="tab-nav">
      <button class="tab-link active" data-tab="tab-dashboard">Dashboard</button>
      <button class="tab-link" data-tab="tab-profile">üë§ Profile</button>
      <button class="tab-link" data-tab="tab-creditors">üìö Creditors</button>
      <button class="tab-link" data-tab="tab-vehicle">üöó Vehicle</button>
      <button class="tab-link" data-tab="tab-credit-report">üí≥ Credit Report</button>
      <button class="tab-link" data-tab="tab-fdcpa">üì¢ FDCPA Log</button>
      <button class="tab-link" data-tab="tab-denial">‚úâÔ∏è Denial</button>
      <button class="tab-link" data-tab="tab-endorsement">üí∏ Endorsement</button>
      <button class="tab-link" data-tab="tab-promise">ü§ù Promise to Pay</button>
    </nav>

    <main class="tab-content">
      <!-- Dashboard Panel -->
      <section id="tab-dashboard" class="tab-panel active">
        <h2>Dashboard</h2>
        <p>Welcome to your Sovereign Finance Cockpit. Select a tool from the navigation above to get started.</p>
        <section id="controls">
          <h2>Global Controls</h2>
          <div class="theme-switch-wrapper">
              <label class="theme-switch" for="themeToggle">
                  <input type="checkbox" id="themeToggle" />
                  <span class="slider round"></span>
              </label>
              <label for="themeToggle" style="cursor: pointer;">Dark Mode</label>
          </div>
          <button id="resetAppBtn">Reset Application</button>
        </section>
        <div id="instrument-tracker">
          <h3>Instrument History Log</h3>
          <label for="customLogEntry">Custom Note:</label>
          <input type="text" id="customLogEntry" placeholder="e.g., Mailed via USPS Certified Mail">
          <button id="trackInstrumentBtn">Add to Log</button>
          <div id="instrumentLog"></div>
        </div>
      </section>

      <!-- User Profile Panel -->
      <section id="tab-profile" class="tab-panel">
        <div id="user-profile">
          <h2>üë§ User Profile</h2>
          <fieldset>
            <legend>Your Information (Used for All Letters)</legend>
            <label for="profileUserName">Your Full Name:</label>
            <input type="text" id="profileUserName" placeholder="John M. Doe">
            <label for="profileUserAddress">Your Full Address (Street, City, State, Zip):</label>
            <input type="text" id="profileUserAddress" placeholder="123 Main St, Anytown, USA 12345">
            <button id="saveProfileBtn">Save Profile</button>
          </fieldset>
        </div>
      </section>

      <!-- Creditor Address Book -->
      <section id="tab-creditors" class="tab-panel">
        <div id="creditor-manager">
          <h2>üìö Creditor Address Book</h2>
          <fieldset>
            <legend>Add New Creditor</legend>
            <label for="newCreditorName">Creditor Name:</label>
            <input type="text" id="newCreditorName" placeholder="ACME Corp">
            <label for="newCreditorAddress">Creditor Full Address:</label>
            <input type="text" id="newCreditorAddress" placeholder="123 Business Rd, Big City, USA 54321">
            <button id="addCreditorBtn">Add to Address Book</button>
          </fieldset>
          <fieldset>
            <legend>Saved Creditors</legend>
            <div id="creditorList"><p class="text-muted">No creditors saved yet.</p></div>
          </fieldset>
        </div>
      </section>

      <!-- Vehicle Financing Panel -->
      <section id="tab-vehicle" class="tab-panel">
        <div id="vehicle-financing">
          <h2>üöó Law-Aware Vehicle Financing</h2>
          <fieldset>
            <legend>1. Upload & Analyze Contract</legend>
            <label for="vehicleContract">Vehicle Contract PDF:</label>
            <input type="file" id="vehicleContract" accept="application/pdf" title="Upload your vehicle financing contract here.">
            <button id="validateDisclosureBtn" title="Check the contract for required TILA disclosures like APR and Finance Charge.">Validate TILA Disclosures</button>
          </fieldset>
          <fieldset id="tila-remedy-details" class="hidden">
              <legend>2. TILA Remedy Letter Details</legend>
              <p class="text-muted" style="margin-top:0;">Missing disclosures found. Please fill out the details below to generate the remedy letter.</p>
              <label for="tilaCreditorSelect">Select Saved Creditor:</label>
              <select id="tilaCreditorSelect"></select>
              <label for="tilaCreditorName">Creditor Name:</label>
              <input type="text" id="tilaCreditorName" placeholder="Or enter name manually">
              <label for="tilaCreditorAddress">Creditor Address:</label>
              <input type="text" id="tilaCreditorAddress" placeholder="Or enter address manually">
              <label for="tilaContractDate">Date of Contract:</label>
              <input type="text" id="tilaContractDate" placeholder="e.g., January 1, 2023">
              <label for="tilaVehicleInfo">Vehicle (Year, Make, Model):</label>
              <input type="text" id="tilaVehicleInfo" placeholder="e.g., 2022 Honda Civic">
              <button id="generateRemedyBtn" title="Generate and download the TILA remedy letter.">Download Letter</button>
              <button id="copyTilaLetterBtn" title="Copy the generated letter text to your clipboard.">Copy Text</button>
          </fieldset>
          <fieldset>
            <legend>3. Scan for Specific Terms</legend>
            <label for="violationTags">Select Term:</label>
            <select id="violationTags">
              <option value="hidden_fee">Hidden Fee</option>
              <option value="misrepresentation">Misrepresentation</option>
              <option value="arbitration">Arbitration</option>
            </select>
            <button id="scanContractBtn" title="Scan the uploaded contract for the selected term.">Scan for Term</button>
          </fieldset>
          <div id="scanResults"></div>
        </div>
      </section>

      <!-- Credit Report Analysis Panel -->
      <section id="tab-credit-report" class="tab-panel">
        <div id="credit-report-analysis">
          <h2>üí≥ Credit Report Analysis (FCRA)</h2>
          <fieldset>
            <legend>1. Identify Inaccuracy</legend>
            <p style="margin-top:0; font-size: 0.9em;" class="text-muted">Under the FCRA (15 U.S.C. ¬ß 1681), you have the right to an accurate credit report. Use this tool to generate a dispute letter for common inaccuracies.</p>
            <label for="fcraViolationSelect">Select Violation Type:</label>
            <select id="fcraViolationSelect"></select>
          </fieldset>
          <fieldset>
              <legend>2. Provide Details</legend>
              <label for="accountNumberInput">Account Name/Number (as it appears on report):</label>
              <input type="text" id="accountNumberInput" placeholder="e.g., Capital One Acct #...1234">
              <label for="disputeReasonInput">Brief Reason for Dispute:</label>
              <input type="text" id="disputeReasonInput" placeholder="e.g., This account is not mine.">
          </fieldset>
          <button id="generateDisputeBtn" title="Generate and download the FCRA dispute letter.">Download Letter</button>
          <button id="copyFcraLetterBtn" title="Copy the generated letter text to your clipboard.">Copy Text</button>
          <div id="fcraResults"></div>
        </div>
      </section>

      <!-- FDCPA Debt Collector Log -->
      <section id="tab-fdcpa" class="tab-panel">
        <div id="fdcpa-logger">
          <h2>üì¢ FDCPA Debt Collector Log</h2>
          <fieldset>
            <legend>1. Log a Violation</legend>
            <p class="text-muted">The FDCPA protects you from abusive debt collection practices. Log each violation here.</p>
            <label for="fdcpaViolationType">Violation Type:</label>
            <select id="fdcpaViolationType"></select>
            <span id="fdcpaSuggestionConfidence" class="text-muted suggestion-text"></span>
            <label for="collectorName">Collector Name/Company:</label>
            <input type="text" id="collectorName" placeholder="e.g., ABC Collections">
            <label for="violationDate">Date of Violation:</label>
            <input type="date" id="violationDate">
            <label for="violationDescription">Brief Description:</label>
            <input type="text" id="violationDescription" placeholder="e.g., Called me at 7 AM.">
            <button id="logFdcpaViolationBtn">Log Violation</button>
          </fieldset>
          <fieldset>
            <legend>2. Violation Log & Action</legend>
            <div id="fdcpaLogDisplay"><p class="text-muted">No violations logged yet.</p></div>
            <button id="prepareCeaseDesistBtn" disabled title="Prepare a Cease and Desist letter for the last logged collector.">Prepare Cease & Desist Letter</button>
            <fieldset id="fdcpa-action-details" class="hidden">
              <legend>Cease & Desist Letter Details</legend>
              <label for="fdcpaCollectorName">Collector Name (auto-filled from last log):</label>
              <input type="text" id="fdcpaCollectorName" readonly>
              <label for="fdcpaCollectorAddress">Collector's Full Address:</label>
              <input type="text" id="fdcpaCollectorAddress" placeholder="789 Collection Rd, Big City, USA 54321">
              <label for="fdcpaAccountNumber">Account/Reference Number (Optional):</label>
              <input type="text" id="fdcpaAccountNumber" placeholder="e.g., Acct #XYZ-123">
              <button id="generateCeaseDesistBtn" title="Generate and download the Cease and Desist letter.">Download Letter</button>
              <button id="copyCeaseDesistBtn" title="Copy the generated letter text to your clipboard.">Copy Text</button>
            </fieldset>
          </fieldset>
        </div>
      </section>

      <!-- Credit Denial Response -->
      <section id="tab-denial" class="tab-panel">
        <div id="denial-letter-response">
          <h2>‚úâÔ∏è Credit Denial Response</h2>
          <fieldset>
            <legend>1. Upload & Analyze Denial Letter</legend>
            <label for="denialLetterUpload">Denial Letter PDF:</label>
            <input type="file" id="denialLetterUpload" accept="application/pdf">
            <button id="analyzeDenialBtn">Analyze Denial Letter</button>
          </fieldset>
          <div id="denial-analysis-results" class="hidden">
            <p><strong>Analysis Complete:</strong> <span id="denialReason"></span></p>
          </div>
          <fieldset id="denial-response-options" class="hidden">
            <legend>2. Choose Your Response</legend>
            <p>Select the type of letter you would like to generate.</p>
            <button id="generateReconsiderationBtn">Generate Letter of Reconsideration</button>
            <button id="generateFcraDisputeBtn">Generate FCRA Dispute Letter</button>
          </fieldset>
          <div id="denial-letter-output" class="hidden">
            <fieldset>
              <legend>3. Generated Letter</legend>
              <div id="reconsideration-inputs" class="hidden">
                  <label for="reconsiderationNote">Add a personal note (optional):</label>
                  <input type="text" id="reconsiderationNote" placeholder="e.g., My income has recently increased.">
              </div>
              <div id="fcra-dispute-inputs" class="hidden">
                  <label for="fcraDisputeItem">Item to dispute:</label>
                  <input type="text" id="fcraDisputeItem" placeholder="e.g., The late payment on my report is incorrect.">
              </div>
              <textarea id="denialLetterText" rows="15" readonly></textarea>
              <button id="copyDenialLetterBtn">Copy Text</button>
              <button id="downloadDenialLetterBtn">Download .txt</button>
            </fieldset>
          </div>
        </div>
      </section>

      <!-- Bill Endorsement Panel -->
      <section id="tab-endorsement" class="tab-panel">
        <div id="bill-endorsement">
          <h2>üí∏ Monthly Bill Endorsement</h2>
          <fieldset>
            <legend>1. Upload & Preview Bill</legend>
            <label for="billUpload">Bill/Instrument PDF:</label>
            <input type="file" id="billUpload" accept="application/pdf">
            <button id="renderPreview">Render Preview</button>
          </fieldset>
          <div id="endorsementStatus"></div>
          <div id="canvas-container">
            <div id="loader" class="loader hidden"></div>
            <canvas id="previewCanvas" width="800" title="Click on the preview to place your endorsement text"></canvas>
          </div>
          <fieldset id="endorsement-fieldset" disabled>
            <legend>2. Prepare Endorsement (then click preview above)</legend>
            <label for="endorsementText">Endorsement Text:</label>
            <input type="text" id="endorsementText" placeholder="Pay to the order of...">
            <label for="qualifier">Qualifier:</label>
            <select id="qualifier">
              <option value="Without Recourse" data-kb-key="WithoutRecourse">Without Recourse (Qualified)</option>
              <option value="For Deposit Only" data-kb-key="ForDepositOnly">For Deposit Only (Restrictive)</option>
              <option value="Under Protest per UCC 1-308" data-kb-key="UCC_1_308">Under Protest (UCC 1-308)</option>
              <option value="Accepted for Value" data-kb-key="AcceptedForValue">Accepted for Value (Controversial)</option>
            </select>
            <div id="qualifier-tooltip" class="tooltip hidden"></div>
            <div id="acceptedForValueWarning" class="warning-message hidden">
              <strong>Warning:</strong> "Accepted for Value" is a controversial theory not recognized in mainstream commercial law and can carry legal risks. Proceed with caution.
            </div>
          </fieldset>
          <fieldset id="finalize-fieldset">
            <legend>3. Finalize & Export</legend>
            <button id="validateNegotiabilityBtn">Validate Negotiability</button>
            <button id="generateTenderLetterBtn" disabled>Generate Tender Letter</button>
            <button id="saveEndorsementBtn" disabled>Save Endorsed PDF</button>
            <button id="generateNonNegotiableNoticeBtn" class="hidden" title="Generate a notice detailing why the instrument is not negotiable.">Generate Non-Negotiable Notice</button>
            <div id="nonNegotiableNoticeContainer" class="hidden">
              <textarea id="nonNegotiableNoticeText" rows="10" readonly></textarea>
              <button id="copyNoticeBtn">Copy Text</button>
              <button id="downloadNoticeBtn">Download .txt</button>
            </div>
            <div id="tenderLetterContainer" class="hidden">
              <h3>Generated Tender Letter</h3>
              <textarea id="tenderLetterText" rows="15" readonly></textarea>
              <button id="copyTenderLetterBtn">Copy Text</button>
              <button id="downloadTenderLetterBtn">Download .txt</button>
            </div>
          </fieldset>
        </div>
      </section>

      <!-- Promise to Pay Letter Panel -->
      <section id="tab-promise" class="tab-panel">
        <div id="promise-to-pay">
          <h2>ü§ù Promise to Pay Letter</h2>
          <fieldset>
            <legend>1. Letter Details</legend>
            <label for="ptpCreditorSelect">Select Saved Creditor:</label>
            <select id="ptpCreditorSelect"></select>
            <label for="ptpCreditorName">Creditor Name:</label>
            <input type="text" id="ptpCreditorName" placeholder="Or enter name manually">
            <label for="ptpCreditorAddress">Creditor Address:</label>
            <input type="text" id="ptpCreditorAddress" placeholder="Or enter address manually">
            <label for="ptpAccountNumber">Account Number:</label>
            <input type="text" id="ptpAccountNumber" placeholder="e.g., ...5678">
            <label for="ptpPromiseAmount">Amount:</label>
            <input type="number" id="ptpPromiseAmount" placeholder="e.g., 500.00">
            <label for="ptpPromiseDate">Date of Promised Payment:</label>
            <input type="date" id="ptpPromiseDate">
          </fieldset>
          <fieldset>
            <legend>2. Generate & Export</legend>
            <button id="generatePtpLetterBtn">Generate Letter</button>
            <div id="ptpLetterContainer" class="hidden" style="margin-top: 15px;">
              <textarea id="ptpLetterText" rows="15" readonly></textarea>
              <div style="margin-top: 10px;">
                  <button id="copyPtpLetterBtn">Copy Text</button>
                  <button id="downloadPtpLetterBtn">Download .txt</button>
              </div>
            </div>
          </fieldset>
        </div>
      </section>
    </main>
  </div>

  <!-- Generic Modal -->
  <div id="confirmationModal" class="modal-overlay hidden">
    <div class="modal-content">
      <h2 id="modalTitle">Confirm Action</h2>
      <div id="modalBody">
        <p>Please confirm the details below:</p>
        <div id="modalDetails"></div>
      </div>
      <div class="modal-footer">
        <button id="modalCancelBtn">Cancel</button>
        <button id="modalConfirmBtn">Confirm</button>
      </div>
    </div>
  </div>

  <script type="module" src="{{ url_for('static', filename='dist/main.js') }}"></script>
</body>
</html>
