<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sovereign Finance Cockpit</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div id="global-loader" class="loader-overlay hidden" role="status" aria-live="polite">
    <div class="loader" aria-label="Loading..."></div>
  </div>

  <h1>ðŸ§  Sovereign Finance Cockpit</h1>
  <section id="controls">
    <h2>Global Controls</h2>
    <div class="theme-switch-wrapper">
        <label class="theme-switch" for="themeToggle">
            <input type="checkbox" id="themeToggle" />
            <span class="slider round"></span>
        </label>
        <label for="themeToggle" style="cursor: pointer;">Dark Mode</label>
    </div>
    <button id="resetAppBtn">Reset Application</button>
    <fieldset>
      <legend>Configuration</legend>
      <label for="sovereignOverlayConfigPath">Sovereign Overlay Config Path:</label>
      <input type="text" id="sovereignOverlayConfigPath" placeholder="e.g., config/sovereign_overlay.yaml">
      <button id="saveConfigPathBtn">Save Config Path</button>
    </fieldset>
  </section>

  <!-- ðŸ‘¤ User Profile Panel -->
  <section id="user-profile">
    <h2>ðŸ‘¤ User Profile</h2>
    <fieldset>
      <legend>Your Information (Used for All Letters)</legend>
      <label for="profileUserName">Your Full Name:</label>
      <input type="text" id="profileUserName" placeholder="John M. Doe">
      <label for="profileUserAddress">Your Full Address (Street, City, State, Zip):</label>
      <input type="text" id="profileUserAddress" placeholder="123 Main St, Anytown, USA 12345">
      <button id="saveProfileBtn">Save Profile</button>
    </fieldset>
  </section>

  <!-- ðŸ“š Creditor Address Book -->
  <section id="creditor-manager">
    <h2>ðŸ“š Creditor Address Book</h2>
    <fieldset>
      <legend>Add New Creditor</legend>
      <label for="newCreditorName">Creditor Name:</label>
      <input type="text" id="newCreditorName" placeholder="ACME Corp">
      <label for="newCreditorAddress">Creditor Full Address:</label>
      <input type="text" id="newCreditorAddress" placeholder="123 Business Rd, Big City, USA 54321">
      <button id="addCreditorBtn">Add to Address Book</button>
    </fieldset>
    <fieldset>
      <legend>Saved Creditors</legend>
      <div id="creditorList"><p class="text-muted">No creditors saved yet.</p></div>
    </fieldset>
  </section>

  <!-- ðŸš— Vehicle Financing Panel -->
  <section id="vehicle-financing">
    <h2>ðŸš— Law-Aware Vehicle Financing</h2>
    <fieldset>
      <legend>1. Upload & Analyze Contract</legend>
      <label for="vehicleContract">Vehicle Contract PDF:</label>
      <input type="file" id="vehicleContract" accept="application/pdf" title="Upload your vehicle financing contract here.">
      <button id="validateDisclosureBtn" title="Check the contract for required TILA disclosures like APR and Finance Charge.">Validate TILA Disclosures</button>
    </fieldset>
    <fieldset id="tila-remedy-details" class="hidden">
        <legend>2. TILA Remedy Letter Details</legend>
        <p class="text-muted" style="margin-top:0;">Missing disclosures found. Please fill out the details below to generate the remedy letter.</p>
        <label for="tilaCreditorSelect">Select Creditor:</label>
        <select id="tilaCreditorSelect"></select>
        <label for="tilaContractDate">Date of Contract:</label>
        <input type="text" id="tilaContractDate" placeholder="e.g., January 1, 2023">
        <label for="tilaVehicleInfo">Vehicle (Year, Make, Model):</label>
        <input type="text" id="tilaVehicleInfo" placeholder="e.g., 2022 Honda Civic">
        <button id="generateRemedyBtn" title="Generate and download the TILA remedy letter.">Download Letter</button>
        <button id="copyTilaLetterBtn" title="Copy the generated letter text to your clipboard.">Copy Text</button>
    </fieldset>
    <fieldset>
      <legend>3. Scan for Specific Terms</legend>
      <label for="violationTags">Select Term:</label>
      <select id="violationTags">
        <option value="hidden_fee">Hidden Fee</option>
        <option value="misrepresentation">Misrepresentation</option>
        <option value="arbitration">Arbitration</option>
      </select>
      <button id="scanContractBtn" title="Scan the uploaded contract for the selected term.">Scan for Term</button>
    </fieldset>
    <div id="scanResults"></div>
  </section>

  <!-- ðŸ’³ Credit Report Analysis Panel -->
  <section id="credit-report-analysis">
    <h2>ðŸ’³ Credit Report Analysis (FCRA)</h2>
    <fieldset>
      <legend>1. Identify Inaccuracy</legend>
      <p style="margin-top:0; font-size: 0.9em;" class="text-muted">Under the FCRA (15 U.S.C. Â§ 1681), you have the right to an accurate credit report. Use this tool to generate a dispute letter for common inaccuracies.</p>
      <label for="fcraViolationSelect">Select Violation Type:</label>
      <select id="fcraViolationSelect">
        <!-- Options will be populated by JS -->
      </select>
    </fieldset>
    <fieldset>
        <legend>2. Provide Details</legend>
        <label for="accountNumberInput">Account Name/Number (as it appears on report):</label>
        <input type="text" id="accountNumberInput" placeholder="e.g., Capital One Acct #...1234">
        <label for="disputeReasonInput">Brief Reason for Dispute:</label>
        <input type="text" id="disputeReasonInput" placeholder="e.g., This account is not mine.">
    </fieldset>
    <button id="generateDisputeBtn" title="Generate and download the FCRA dispute letter.">Download Letter</button>
    <button id="copyFcraLetterBtn" title="Copy the generated letter text to your clipboard.">Copy Text</button>
    <div id="fcraResults"></div>
  </section>

  <!-- ðŸ“¢ FDCPA Debt Collector Log -->
  <section id="fdcpa-logger">
    <h2>ðŸ“¢ FDCPA Debt Collector Log</h2>
    <fieldset>
      <legend>1. Log a Violation</legend>
      <p class="text-muted">The FDCPA protects you from abusive debt collection practices. Log each violation here.</p>
      <label for="fdcpaViolationType">Violation Type:</label>
      <select id="fdcpaViolationType"></select>
      <span id="fdcpaSuggestionConfidence" class="text-muted suggestion-text"></span>
      <label for="collectorName">Collector Name/Company:</label>
      <input type="text" id="collectorName" placeholder="e.g., ABC Collections">
      <label for="violationDate">Date of Violation:</label>
      <input type="date" id="violationDate">
      <label for="violationDescription">Brief Description:</label>
      <input type="text" id="violationDescription" placeholder="e.g., Called me at 7 AM.">
      <button id="logFdcpaViolationBtn">Log Violation</button>
    </fieldset>
    <fieldset>
      <legend>2. Violation Log & Action</legend>
      <div id="fdcpaLogDisplay"><p class="text-muted">No violations logged yet.</p></div>
      <button id="prepareCeaseDesistBtn" disabled title="Prepare a Cease and Desist letter for the last logged collector.">Prepare Cease & Desist Letter</button>
      <fieldset id="fdcpa-action-details" class="hidden">
        <legend>Cease & Desist Letter Details</legend>
        <label for="fdcpaCollectorName">Collector Name (auto-filled from last log):</label>
        <input type="text" id="fdcpaCollectorName" readonly>
        <label for="fdcpaCollectorAddress">Collector's Full Address:</label>
        <input type="text" id="fdcpaCollectorAddress" placeholder="789 Collection Rd, Big City, USA 54321">
        <label for="fdcpaAccountNumber">Account/Reference Number (Optional):</label>
        <input type="text" id="fdcpaAccountNumber" placeholder="e.g., Acct #XYZ-123">
        <button id="generateCeaseDesistBtn" title="Generate and download the Cease and Desist letter.">Download Letter</button>
        <button id="copyCeaseDesistBtn" title="Copy the generated letter text to your clipboard.">Copy Text</button>
      </fieldset>
    </fieldset>
  </section>

  <!-- ðŸ’¸ Bill Endorsement Panel -->
  <section id="bill-endorsement">
    <h2>ðŸ’¸ Monthly Bill Endorsement</h2>
    <fieldset>
      <legend>1. Upload & Preview Bill</legend>
      <label for="billUpload">Bill/Instrument PDF:</label>
      <input type="file" id="billUpload" accept="application/pdf">
      <button id="renderPreview">Render Preview</button>
    </fieldset>
    <div id="endorsementStatus"></div>
    <div id="canvas-container">
      <div id="loader" class="loader hidden"></div>
      <canvas id="previewCanvas" width="800" title="Click on the preview to place your endorsement text"></canvas>
    </div>
    <fieldset id="endorsement-fieldset" disabled>
      <legend>2. Prepare Endorsement (then click preview above)</legend>
      <label for="endorsementText">Endorsement Text:</label>
      <input type="text" id="endorsementText" placeholder="Pay to the order of...">
      <label for="qualifier">Qualifier:</label>
      <select id="qualifier">
        <option value="Without Recourse" data-kb-key="WithoutRecourse">Without Recourse (Qualified)</option>
        <option value="For Deposit Only" data-kb-key="ForDepositOnly">For Deposit Only (Restrictive)</option>
        <option value="Under Protest per UCC 1-308" data-kb-key="UCC_1_308">Under Protest (UCC 1-308)</option>
        <option value="Accepted for Value" data-kb-key="AcceptedForValue">Accepted for Value (Controversial)</option>
      </select>
      <div id="qualifier-tooltip" class="tooltip hidden"></div>
      <div id="acceptedForValueWarning" class="warning-message hidden">
        <strong>Warning:</strong> "Accepted for Value" is a controversial theory not recognized in mainstream commercial law and can carry legal risks. Proceed with caution.
      </div>
    </fieldset>
    <fieldset id="finalize-fieldset">
      <legend>3. Finalize & Export</legend>
      <button id="validateNegotiabilityBtn">Validate Negotiability</button>
      <button id="generateTenderLetterBtn" disabled>Generate Tender Letter</button>
      <button id="saveEndorsementBtn" disabled>Save Endorsed PDF</button>
      <button id="generateNonNegotiableNoticeBtn" class="hidden" title="Generate a notice detailing why the instrument is not negotiable.">Generate Non-Negotiable Notice</button>
      <div id="nonNegotiableNoticeContainer" class="hidden">
        <textarea id="nonNegotiableNoticeText" rows="10" readonly></textarea>
        <button id="copyNoticeBtn">Copy Text</button>
        <button id="downloadNoticeBtn">Download .txt</button>
      </div>
    </fieldset>
    <div id="instrument-tracker">
      <h3>Instrument History Log</h3>
      <label for="customLogEntry">Custom Note:</label>
      <input type="text" id="customLogEntry" placeholder="e.g., Mailed via USPS Certified Mail">
      <button id="trackInstrumentBtn">Add to Log</button>
      <div id="instrumentLog"></div>
    </div>
  </section>

  <!-- ðŸ§© Commentary Overlay -->
  <section id="commentary">
    <h2>ðŸ§© Commentary & Case Law</h2>
    <ul>
      <li><strong>Black's Law Dictionary:</strong> Foundational source for legal definitions.</li>
      <li><strong>UCC Official Comments:</strong> Authoritative guidance for interpreting the Uniform Commercial Code.</li>
      <li><strong>Henson v. Santander Consumer USA Inc. (2017):</strong> Supreme Court case clarifying the definition of "debt collector" under the FDCPA.</li>
      <li><strong>Brandon Joe Williams:</strong> Authorship & Remedy</li>
      <li><strong>David Straight:</strong> Jurisdictional Clarity</li>
    </ul>
  </section>

  <!-- ðŸŒ€ Sovereign Loop Tracker -->
  <section id="sovereign-loop">
    <h2>ðŸŒ€ Sovereign Loop</h2>
    <ol>
      <li id="loop-intake">Intake</li>
      <li id="loop-validate">Validate</li>
      <li id="loop-remedy">Remedy</li>
      <li id="loop-log">Log</li>
      <li id="loop-reflect">Reflect</li>
    </ol>
  </section>

  <script type="module" src="{{ url_for('static', filename='dist/assets/main-BauKMS_P.js') }}"></script>
</body>
</html>